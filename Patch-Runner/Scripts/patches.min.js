var addLog,fillRecentList,getLogDate,getLogs,saveLog,setEnabled,setProgress,setState,showRecent,showRunPatch,sortBy;$.fn.disable=function(){return setState($(this),true)};$.fn.enable=function(){return setState($(this),false)};$.fn.isDisabled=function(){return $(this).hasClass("disabled")};setState=function(a,b){a.each(function(){if($(this).is("button, input")){$(this).prop("disabled",b)}if(b){return $(this).addClass("disabled")}else{return $(this).removeClass("disabled")}});return $("body").on("click","a.disabled",function(){return false})};$(function(){var a,b;b=$.connection.patchHub;a=b.client;$("#recent-view").click(function(){return showRecent()});$("#recent-clear").click(function(){$("#recent-modal .btn-stateful").disable();$.jStorage.flush();return fillRecentList()});$("#recent-run").click(function(){if($(this).isDisabled()){return false}$("#recent-modal").modal("hide");return $.connection.patchHub.server.runPatch($("#recent-list").find(".success").attr("name"))});$("#patch-close").click(function(){if($(this).isDisabled()){return false}return $("#progress-modal").modal("hide")});$("#patch-run-again").click(function(){if($(this).isDisabled()){return false}return $.connection.patchHub.server.runPatch($("#progress-name").html())});$.connection.hub.start().done(function(){return $("#patch-run").click(function(){return b.server.runPatch($("#patch-name").val())})});a.patchStart=function(c){return showRunPatch(c)};a.patchProgress=function(c){return setProgress(c)};a.patchLog=function(d,c){return addLog('<blockquote class="alert-info" style="padding:5px;margin:3px;"><p>'+d+"</p></blockquote>",c)};a.patchSuccess=function(d,c){$("#progress-modal .btn-stateful").enable();addLog('<blockquote class="alert-success" style="padding:5px;margin:3px;"><h4>Success</h4>Time elapsed : <strong>'+c+"</strong></blockquote>",true);return saveLog(d)};a.patchError=function(f,e,c,d){$("#progress-modal .btn-stateful").enable();$("#progress-bar").removeClass("bar-success").addClass("bar-danger");addLog('			<blockquote class="alert-error" style="padding:5px;margin:3px;">				<h4>Error</h4>				<table class="table table-condensed alert-error">					<tr><td class="span1">Method</td><td>'+e+'</td></tr>					<tr><td class="span1">Line</td><td><strong>'+c+'</td></tr>					<tr><td class="span1">Message</td><td><em style="font-size:12px;">'+d+"</em></td></tr>				</table>			</blockquote>",true);return saveLog(f)};return});showRecent=function(){$("#recent-modal .btn-stateful").disable();fillRecentList();return $("#recent-modal").modal({keyboard:false,backdrop:"static"})};fillRecentList=function(){var a;a=getLogs();a.sort(function(c,d){return sortBy("date",c,d,true)});return $("#recent-list").empty().append(function(){var e,b,c,d;d=[];for(b=0,c=a.length;b<c;b++){e=a[b];d.push($('<tr name="'+e.name+'"><td>'+e.date+"</td><td>"+e.name+"</td></tr>"))}return d}).on("click","tr",function(){$("#recent-modal .btn-stateful").enable();return $(this).addClass("success").siblings().removeClass("success")})};showRunPatch=function(a){$("#progress-name").html(a);$("#progress-log").empty();$("#progress-bar").removeClass("bar-danger").addClass("bar-success");setProgress("0%");$("#progress-modal .btn-stateful").disable();$("#progress-modal").modal({keyboard:false,backdrop:"static"});return addLog('<blockquote class="alert-success" style="padding:5px;margin:3px;"><h4>Started</h4></blockquote>')};getLogs=function(){var a;return(a=$.jStorage.get("patch-logs"))!=null?a:[{name:"[nothing run yet]",date:""}]};saveLog=function(d){var a,c,b;a=$("#progress-log");c=(b=$.jStorage.get("patch-logs"))!=null?b:[];c.push({name:d,date:getLogDate()});return $.jStorage.set("patch-logs",c)};setProgress=function(a){$("#progress-percent").html(a);return $("#progress-bar").css("width",a)};addLog=function(d,c){var a,b;b=$("<div/>",{html:d});a=$("#progress-log");if(!c){a.find(".alert-info").last().remove()}a.append(b);return a.parent().scrollTop(a.height())};getLogDate=function(){var a,b;b=function(c){if(c<10){return"0"+c}else{return""+c}};a=new Date;return""+(b(a.getDate()))+"-"+(b(a.getMonth()+1))+"-"+(a.getFullYear())+" "+(b(a.getHours()))+":"+(b(a.getMinutes()))+":"+(b(a.getSeconds()))};sortBy=function(e,c,d,f){f=f?1:-1;if(c[e]>d[e]){return -1*f}if(c[e]<d[e]){return +1*f}return 0};setEnabled=function(a,b){a.prop("disabled",!b);if(b){return a.removeAttr("disabled")}else{return a.attr("disabled","disabled")}};