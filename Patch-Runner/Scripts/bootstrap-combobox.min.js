!function(b){var a=function(d,c){this.options=b.extend({},b.fn.combobox.defaults,c);this.$source=b(d);this.$container=this.setup();this.$element=this.$container.find("input[type=text]");this.$target=this.$container.find("input[type=hidden]");this.$button=this.$container.find(".dropdown-toggle");this.$menu=b(this.options.menu).appendTo("body");this.matcher=this.options.matcher||this.matcher;this.sorter=this.options.sorter||this.sorter;this.highlighter=this.options.highlighter||this.highlighter;this.shown=false;this.selected=false;this.refresh();this.transferAttributes();this.listen()};a.prototype=b.extend({},b.fn.typeahead.Constructor.prototype,{constructor:a,setup:function(){var c=b(this.options.template);this.$source.before(c);this.$source.hide();return c},parse:function(){var d=this,f={},e=[],c=false;this.$source.find("option").each(function(){var g=b(this);if(g.val()===""){d.options.placeholder=g.text();return}f[g.text()]=g.val();e.push(g.text());if(g.attr("selected")){c=g.html()}});this.map=f;if(c){this.$element.val(c);this.$container.addClass("combobox-selected");this.selected=true}return e},transferAttributes:function(){this.options.placeholder=this.$source.attr("data-placeholder")||this.options.placeholder;this.$element.attr("placeholder",this.options.placeholder);this.$target.prop("name",this.$source.prop("name"));this.$target.val(this.$source.val());this.$source.removeAttr("name");this.$element.attr("required",this.$source.attr("required"));this.$element.attr("rel",this.$source.attr("rel"));this.$element.attr("title",this.$source.attr("title"));this.$element.attr("class",this.$source.attr("class"))},toggle:function(){if(this.$container.hasClass("combobox-selected")){this.clearTarget();this.triggerChange();this.clearElement()}else{if(this.shown){this.hide()}else{this.clearElement();this.lookup()}}},clearElement:function(){this.$element.val("").focus()},clearTarget:function(){this.$source.val("");this.$target.val("");this.$container.removeClass("combobox-selected");this.selected=false},triggerChange:function(){this.$source.trigger("change")},refresh:function(){this.source=this.parse();this.options.items=this.source.length},select:function(){var c=this.$menu.find(".active").attr("data-value");this.$element.val(this.updater(c)).trigger("change");this.$source.val(this.map[c]).trigger("change");this.$target.val(this.map[c]).trigger("change");this.$container.addClass("combobox-selected");this.selected=true;return this.hide()},lookup:function(c){this.query=this.$element.val();return this.process(this.source)},listen:function(){this.$element.on("focus",b.proxy(this.focus,this)).on("blur",b.proxy(this.blur,this)).on("keypress",b.proxy(this.keypress,this)).on("keyup",b.proxy(this.keyup,this));if(this.eventSupported("keydown")){this.$element.on("keydown",b.proxy(this.keydown,this))}this.$menu.on("click",b.proxy(this.click,this)).on("mouseenter","li",b.proxy(this.mouseenter,this)).on("mouseleave","li",b.proxy(this.mouseleave,this));this.$button.on("click",b.proxy(this.toggle,this))},keyup:function(c){switch(c.keyCode){case 40:case 39:case 38:case 37:case 36:case 35:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown){return}this.select();break;case 27:if(!this.shown){return}this.hide();break;default:this.clearTarget();this.lookup()}c.stopPropagation();c.preventDefault()},blur:function(d){var c=this;this.focused=false;var f=this.$element.val();if(!this.selected&&f!==""){this.$element.val("");this.$source.val("").trigger("change");this.$target.val("").trigger("change")}if(!this.mousedover&&this.shown){setTimeout(function(){c.hide()},200)}},mouseleave:function(c){this.mousedover=false}});b.fn.combobox=function(c){return this.each(function(){var f=b(this),e=f.data("combobox"),d=typeof c=="object"&&c;if(!e){f.data("combobox",(e=new a(this,d)))}if(typeof c=="string"){e[c]()}})};b.fn.combobox.defaults={template:'<div class="combobox-container"><input type="hidden" /><input type="text" autocomplete="off" /><span class="add-on btn dropdown-toggle" data-dropdown="dropdown"><span class="caret"/><span class="combobox-clear"><i class="icon-remove"/></span></span></div>',menu:'<ul class="typeahead typeahead-long dropdown-menu"></ul>',item:'<li><a href="#"></a></li>'};b.fn.combobox.Constructor=a}(window.jQuery);